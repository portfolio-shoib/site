<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Prayer Times - Shoib&#x27;s Space</title><meta name="description" content="The digital home of Shoibâ€™s thoughts, projects, and passions."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://www.shoib.me/prayer-times/"><link rel="alternate" type="application/atom+xml" href="https://www.shoib.me/feed.xml" title="Shoib&#x27;s Space - RSS"><link rel="alternate" type="application/json" href="https://www.shoib.me/feed.json" title="Shoib&#x27;s Space - JSON"><meta property="og:title" content="Prayer Times"><meta property="og:image" content="https://www.shoib.me/media/website/icons8-swot-analysis-400.png"><meta property="og:image:width" content="400"><meta property="og:image:height" content="400"><meta property="og:site_name" content="Shoib's Space"><meta property="og:description" content="The digital home of Shoibâ€™s thoughts, projects, and passions."><meta property="og:url" content="https://www.shoib.me/prayer-times/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://www.shoib.me/media/website/icons8-swot-analysis-50-3.png" type="image/png"><link rel="preload" href="https://www.shoib.me/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://www.shoib.me/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://www.shoib.me/assets/css/style.css?v=2e46e1f2fc98a3dc054c47a693e5312f"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.shoib.me/prayer-times/"},"headline":"Prayer Times","datePublished":"2025-05-29T22:11+05:00","dateModified":"2025-05-31T20:35+05:00","image":{"@type":"ImageObject","url":"https://www.shoib.me/media/website/icons8-swot-analysis-400.png","height":400,"width":400},"description":"The digital home of Shoibâ€™s thoughts, projects, and passions.","author":{"@type":"Person","name":"Muhammad Shoib","url":"https://www.shoib.me/authors/muhammad-shoib/"},"publisher":{"@type":"Organization","name":"Muhammad Shoib","logo":{"@type":"ImageObject","url":"https://www.shoib.me/media/website/icons8-swot-analysis-400.png","height":400,"width":400}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><style>.extlink::after {
				background-color: currentColor;
				content: "";
				display: inline-block;
				height: 16px;
				margin-left: 5px;
				position: relative;
				top: 0px;
				width: 16px;
			}
		
					.extlink.extlink-icon-1::after {
						mask-image: url("data:image/svg+xml;utf8,<svg viewBox='0 0 24 24' fill='none' stroke='%23000000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' xmlns='http://www.w3.org/2000/svg'><path d='M15 3h6v6'/><path d='M10 14 21 3'/><path d='M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6'/></svg>");
						mask-repeat: no-repeat;
						mask-size: contain;
					}</style><style>.fi{fill:none;stroke-linecap:round;stroke-linejoin:round;vertical-align:middle}</style></head><body class="page-template"><div class="container container--center"><header class="header"><div class="header__logo"><a class="logo" href="https://www.shoib.me/"><img src="https://www.shoib.me/media/website/icons8-swot-analysis-400.png" alt="Shoib&#x27;s Space" width="400" height="400"></a></div><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Pages</span><ul class="navbar__submenu level-2" aria-hidden="true"><li class="has-submenu"><a href="https://www.shoib.me/blog-and-insights/" target="_self" aria-haspopup="true">Blog</a><ul class="navbar__submenu level-3" aria-hidden="true"><li class="has-submenu"><a href="https://www.shoib.me/projects-and-case-studies/" target="_self" aria-haspopup="true">Projects &amp; Case Studies</a><ul class="navbar__submenu level-4" aria-hidden="true"><li><a href="https://www.shoib.me/services-and-solutions/" target="_self">Services &amp; Solutions</a></li></ul></li></ul></li></ul></li><li class="active"><a href="https://www.shoib.me/prayer-times/" target="_self">Prayer Times</a></li><li><a href="https://www.shoib.me/advanced-lunar-month-calculator/" target="_self">Advanced Lunar Month Calculator</a></li><li><a href="https://www.shoib.me/quran-explorer/" target="_self">ðŸ“– Quran Explorer</a></li></ul></nav></header><main class="content page"><article class="post"><header><h1 class="post__title">Prayer Times</h1></header><div class="post__entry"><div class="container"><h1>Prayer Times</h1><div class="settings-panel"><h3>Settings</h3><div class="input-group"><label for="method">Calc Method:</label><select><option value="2">UoI Sciences, Karachi</option><option value="1">Muslim World League</option><option value="3">ISNA (North America)</option><option value="4">Umm Al-Qura, Makkah</option><option value="5">Egyptian General Auth.</option><option value="7">Uni. of Tehran Geo.</option><option value="8">Gulf Region</option><option value="9">Kuwait</option><option value="10">Qatar</option><option value="11">Majlis Ugama Islam, SG</option><option value="12">UOIF (France)</option><option value="13">Diyanet (Turkey)</option><option value="15">Dubai (unofficial)</option><option value="16">Moonsighting Committee</option></select></div><div class="input-group"><label for="school">Asr Juristic:</label><select id="school"><option value="0">Standard (Shafii, Maliki, Hanbali)</option><option value="1">Hanafi</option></select></div><div class="button-group"><button id="fetchTimesButton">Get/Refresh Prayer Times</button></div></div><div id="current-location-info">Detecting location...</div><div id="result"><p>Click the button above or allow location access to fetch prayer times.</p></div><footer><p>Prayer times provided by <a href="https://aladhan.com/" target="_blank" class="extlink extlink-icon-1" rel="noopener">AlAdhan API</a>. Location details by BigDataCloud.</p></footer></div><p><script>const resultDiv = document.getElementById('result');
        const methodSelect = document.getElementById('method');
        const schoolSelect = document.getElementById('school');
        const fetchTimesButton = document.getElementById('fetchTimesButton');
        const currentLocationInfoDiv = document.getElementById('current-location-info');

        let prayerTimingsData = null;
        let countdownInterval = null;
        let lastKnownLatitude = null;
        let lastKnownLongitude = null;
        let lastKnownReadableLocation = null;


        function saveSettings() {
            localStorage.setItem('prayerAppMethod', methodSelect.value);
            localStorage.setItem('prayerAppSchool', schoolSelect.value);
        }

        function loadSettings() {
            methodSelect.value = localStorage.getItem('prayerAppMethod') || '2';
            schoolSelect.value = localStorage.getItem('prayerAppSchool') || '0';
        }

        function showLoading(message = 'Loading...') {
            resultDiv.innerHTML = `<p style="text-align:center;">${message}</p>`;
            if (countdownInterval) clearInterval(countdownInterval);
        }

        function displayError(message, targetDiv = resultDiv) {
            targetDiv.innerHTML = `<p class="error-message">${message}</p>`;
            if (countdownInterval) clearInterval(countdownInterval);
        }

        function updateCurrentLocationInfo(info) {
            currentLocationInfoDiv.textContent = info;
        }

        async function getReadableLocation(latitude, longitude) {
            try {
                const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`);
                if (!response.ok) {
                    console.warn(`Reverse geocoding failed: ${response.status}`);
                    return `Lat: ${latitude.toFixed(2)}, Lon: ${longitude.toFixed(2)}`;
                }
                const data = await response.json();
                const locationParts = [data.locality, data.city, data.principalSubdivision, data.countryName].filter(Boolean);
                // Remove duplicates that might occur if city and locality are the same.
                const uniqueLocationParts = [...new Set(locationParts)];
                if (uniqueLocationParts.length > 0) {
                    return uniqueLocationParts.join(', ');
                } else {
                    return `Lat: ${latitude.toFixed(2)}, Lon: ${longitude.toFixed(2)} (Location details not found)`;
                }
            } catch (error) {
                console.error('Error in reverse geocoding:', error);
                return `Lat: ${latitude.toFixed(2)}, Lon: ${longitude.toFixed(2)} (Error fetching location name)`;
            }
        }

        async function fetchPrayerData(latitude, longitude, method, school, readableLocation) {
            const locationForDisplay = readableLocation || `Lat: ${latitude.toFixed(2)}, Lon: ${longitude.toFixed(2)}`;
            showLoading(`Fetching prayer times for ${locationForDisplay}...`);
            
            const todayTimestamp = Math.floor(Date.now() / 1000);
            const url = `https://api.aladhan.com/v1/timings/${todayTimestamp}?latitude=${latitude}&longitude=${longitude}&method=${method}&school=${school}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ data: `HTTP error ${response.status}` }));
                    throw new Error(errorData.data || response.statusText || `HTTP error ${response.status}`);
                }
                const data = await response.json();
                if (data.code !== 200) {
                    throw new Error(data.status || data.data || 'Invalid response from API');
                }

                prayerTimingsData = data.data;
                lastKnownLatitude = latitude;
                lastKnownLongitude = longitude;
                lastKnownReadableLocation = readableLocation; // Store the successfully used readable location

                displayPrayerTimes(prayerTimingsData);
                const timezone = prayerTimingsData.meta?.timezone || 'N/A';
                updateCurrentLocationInfo(`Displaying times for: ${locationForDisplay} (Timezone: ${timezone})`);
                saveSettings();
            } catch (error) {
                console.error('API Error:', error);
                displayError(`Failed to fetch prayer times: ${error.message}`);
                updateCurrentLocationInfo(`Could not fetch times. Using location: ${locationForDisplay}`);
            }
        }

        async function fetchTimesUsingGeolocation() {
            if (!navigator.geolocation) {
                displayError('Geolocation is not supported by this browser.');
                updateCurrentLocationInfo('Geolocation not supported.');
                return;
            }
            updateCurrentLocationInfo('Attempting to get your location...');
            showLoading('Getting your location details...');

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    const method = methodSelect.value;
                    const school = schoolSelect.value;

                    updateCurrentLocationInfo(`Coordinates found (Lat: ${latitude.toFixed(2)}, Lon: ${longitude.toFixed(2)}). Fetching location name...`);
                    const readableLocationName = await getReadableLocation(latitude, longitude);
                    
                    fetchPrayerData(latitude, longitude, method, school, readableLocationName);
                },
                (error) => {
                    let errorMsg = 'Error getting location: ';
                    // ... (switch case for error.code as before)
                    switch (error.code) {
                        case error.PERMISSION_DENIED: errorMsg += "User denied Geolocation."; break;
                        case error.POSITION_UNAVAILABLE: errorMsg += "Location information unavailable."; break;
                        case error.TIMEOUT: errorMsg += "Location request timed out."; break;
                        default: errorMsg += "An unknown error occurred."; break;
                    }
                    console.error('Geolocation Error:', errorMsg);
                    displayError(errorMsg);
                    updateCurrentLocationInfo('Could not retrieve location. Please ensure location services are enabled or try again.');
                },
                { timeout: 10000, enableHighAccuracy: true }
            );
        }
        
        function timeToMinutes(timeStr) {
            if (!timeStr || !timeStr.includes(':')) return 0;
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function formatTimeForDisplay(timeStr) {
            if (!timeStr || !timeStr.includes(':')) return "N/A";
            let [hours, minutes] = timeStr.split(':').map(Number);
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12;
            const minutesStr = minutes < 10 ? '0' + minutes : minutes.toString();
            return `${hours}:${minutesStr} ${ampm}`;
        }

        function getPrayerStates() {
            if (!prayerTimingsData || !prayerTimingsData.timings) return null;
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            const prayerOrder = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            const displayPrayers = prayerOrder
                .map(pName => ({ name: pName, time: prayerTimingsData.timings[pName] }))
                .filter(p => p.time);
            if(displayPrayers.length === 0) return null;

            let nextPrayer = null;
            let currentPrayerWindow = null;

            for (const prayer of displayPrayers) {
                if (timeToMinutes(prayer.time) > currentMinutes) {
                    nextPrayer = prayer;
                    break;
                }
            }
            if (!nextPrayer && displayPrayers.length > 0) {
                nextPrayer = { ...displayPrayers[0], isNextDay: true };
            }

            for (let i = 0; i < displayPrayers.length; i++) {
                const prayer = displayPrayers[i];
                if (prayer.name === 'Sunrise') continue;
                const prayerStartMinutes = timeToMinutes(prayer.time);
                let prayerEndMinutes;
                if (prayer.name === 'Isha') {
                    const fajrTime = displayPrayers.find(p=> p.name === 'Fajr')?.time;
                    prayerEndMinutes = fajrTime ? timeToMinutes(fajrTime) + 24 * 60 : 24 * 60; 
                } else {
                     const nextPrayerInListForEnd = displayPrayers[i + 1];
                     prayerEndMinutes = nextPrayerInListForEnd ? timeToMinutes(nextPrayerInListForEnd.time) : 24 * 60;
                }
                if (currentMinutes >= prayerStartMinutes && currentMinutes < prayerEndMinutes) {
                    currentPrayerWindow = prayer;
                    break; 
                }
            }
            if (!currentPrayerWindow && displayPrayers.length > 0) {
                const ishaPrayer = displayPrayers.find(p => p.name === 'Isha');
                if (ishaPrayer && currentMinutes >= timeToMinutes(ishaPrayer.time)) {
                     currentPrayerWindow = ishaPrayer;
                }
            }
            return { displayPrayers, nextPrayer, currentPrayerWindow };
        }

        function displayPrayerTimes(data) {
            const gregorianDate = data.date?.readable || 'Date N/A';
            const hijriDateData = data.date?.hijri;
            const hijriDate = hijriDateData ? 
                `${hijriDateData.day} ${hijriDateData.month.en} ${hijriDateData.year} <span class="hijri-date">(${hijriDateData.month.ar})</span>`
                : 'Hijri Date N/A';
            const prayerStates = getPrayerStates();
            if (!prayerStates) {
                displayError("Could not process prayer times. Data might be incomplete.");
                return;
            }
            const { displayPrayers, nextPrayer, currentPrayerWindow } = prayerStates;

            resultDiv.innerHTML = `
                <h2>Prayer Times</h2>
                <p class="date-info">${gregorianDate} / ${hijriDate}</p>
                <div id="countdown">Initializing countdown...</div>
                <ul>
                    ${displayPrayers.map(prayer => 
                        `<li class="${nextPrayer && prayer.name === nextPrayer.name && !prayer.isNextDay ? 'next-prayer-highlight' : ''} ${currentPrayerWindow && prayer.name === currentPrayerWindow.name ? 'current-prayer-window' : ''}">
                            <span>${prayer.name}</span>
                            <span>${formatTimeForDisplay(prayer.time)}</span>
                        </li>`
                    ).join('')}
                </ul>
            `;
            if (nextPrayer) startCountdown(nextPrayer);
            else document.getElementById('countdown').innerHTML = "All prayers for the day may have passed or data is unavailable.";
        }
        
        function startCountdown(nextPrayerInfo) {
            if (countdownInterval) clearInterval(countdownInterval);
            const countdownDiv = document.getElementById('countdown');
            if (!countdownDiv) return;

            function updateCountdown() {
                const now = new Date();
                if (!nextPrayerInfo || !nextPrayerInfo.time || !nextPrayerInfo.time.includes(':')) {
                    countdownDiv.innerHTML = "Next prayer time unavailable.";
                    clearInterval(countdownInterval);
                    return;
                }
                const [hours, minutes] = nextPrayerInfo.time.split(':').map(Number);
                const nextPrayerDateTime = new Date(now);
                nextPrayerDateTime.setHours(hours, minutes, 0, 0);

                if (nextPrayerInfo.isNextDay || (nextPrayerDateTime < now && nextPrayerInfo.name === "Fajr")) {
                    nextPrayerDateTime.setDate(nextPrayerDateTime.getDate() + 1);
                } else if (nextPrayerDateTime < now) {
                     countdownDiv.innerHTML = `Time for ${nextPrayerInfo.name}! Refreshing...`;
                     clearInterval(countdownInterval);
                     setTimeout(() => { if(prayerTimingsData) displayPrayerTimes(prayerTimingsData); }, 2000);
                     return;
                }
                const diff = nextPrayerDateTime - now;
                if (diff <= 0) {
                    countdownDiv.innerHTML = `Time for ${nextPrayerInfo.name}!`;
                    clearInterval(countdownInterval);
                    setTimeout(() => { if(prayerTimingsData) displayPrayerTimes(prayerTimingsData); }, 2000);
                    return;
                }
                const h = Math.floor(diff / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);
                countdownDiv.innerHTML = `Time until ${nextPrayerInfo.name}: ${h}h ${m}m ${s}s`;
            }
            countdownInterval = setInterval(updateCountdown, 1000);
            updateCountdown();
        }

        fetchTimesButton.addEventListener('click', fetchTimesUsingGeolocation);
        
        [methodSelect, schoolSelect].forEach(sel => {
            sel.addEventListener('change', () => {
                saveSettings(); 
                if (lastKnownLatitude && lastKnownLongitude) {
                    // If location is known, re-fetch prayer times with new settings for that location
                    updateCurrentLocationInfo(`Settings changed. Refreshing times for ${lastKnownReadableLocation || `Lat: ${lastKnownLatitude.toFixed(2)}, Lon: ${lastKnownLongitude.toFixed(2)}`}...`);
                    fetchPrayerData(lastKnownLatitude, lastKnownLongitude, methodSelect.value, schoolSelect.value, lastKnownReadableLocation);
                } else {
                    // If location not known, prompt user to fetch location
                    updateCurrentLocationInfo("Settings changed. Click 'Get/Refresh Prayer Times' to apply with your current location.");
                }
            });
        });

        window.addEventListener('load', () => {
            loadSettings();
            fetchTimesUsingGeolocation(); 
        });</script></p></div></article></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p><span style="color: #2dc26b;">Â© 2025 All rights reserved. This website and its content are the property of the owner</span></p></div></div></footer></div><script defer="defer" src="https://www.shoib.me/assets/js/scripts.min.js?v=c2232aa7558e9517946129d2a1b8c770"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'overlay',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script>(function() {
			var originalTitle = document.title;
			var timeout;
			document.addEventListener("visibilitychange", function() {
				if (document.hidden) {
					document.title = "ðŸ‘€ We miss you! Plz Come back!";
				} else {
					clearTimeout(timeout);
					document.title = "ðŸŽ‰ Welcome back!";
							setTimeout(function() {
								document.title = originalTitle;
							}, 2000);
				}
			});
		})();</script></body></html>