<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Advanced Qibla Direction Finder - Shoib&#x27;s Space</title><meta name="description" content="The digital home of Shoib’s thoughts, projects, and passions."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://www.shoib.me/advanced-qibla-direction-finder/"><link rel="alternate" type="application/atom+xml" href="https://www.shoib.me/feed.xml" title="Shoib&#x27;s Space - RSS"><link rel="alternate" type="application/json" href="https://www.shoib.me/feed.json" title="Shoib&#x27;s Space - JSON"><meta property="og:title" content="Advanced Qibla Direction Finder"><meta property="og:image" content="https://www.shoib.me/media/website/icons8-swot-analysis-400.png"><meta property="og:image:width" content="400"><meta property="og:image:height" content="400"><meta property="og:site_name" content="Shoib's Space"><meta property="og:description" content="The digital home of Shoib’s thoughts, projects, and passions."><meta property="og:url" content="https://www.shoib.me/advanced-qibla-direction-finder/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://www.shoib.me/media/website/icons8-swot-analysis-50-3.png" type="image/png"><link rel="preload" href="https://www.shoib.me/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://www.shoib.me/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://www.shoib.me/assets/css/style.css?v=2e46e1f2fc98a3dc054c47a693e5312f"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.shoib.me/advanced-qibla-direction-finder/"},"headline":"Advanced Qibla Direction Finder","datePublished":"2025-05-27T23:08+05:00","dateModified":"2025-05-27T23:08+05:00","image":{"@type":"ImageObject","url":"https://www.shoib.me/media/website/icons8-swot-analysis-400.png","height":400,"width":400},"description":"The digital home of Shoib’s thoughts, projects, and passions.","author":{"@type":"Person","name":"Muhammad Shoib","url":"https://www.shoib.me/authors/muhammad-shoib/"},"publisher":{"@type":"Organization","name":"Muhammad Shoib","logo":{"@type":"ImageObject","url":"https://www.shoib.me/media/website/icons8-swot-analysis-400.png","height":400,"width":400}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><style>.extlink::after {
				background-color: currentColor;
				content: "";
				display: inline-block;
				height: 16px;
				margin-left: 5px;
				position: relative;
				top: 0px;
				width: 16px;
			}
		
					.extlink.extlink-icon-1::after {
						mask-image: url("data:image/svg+xml;utf8,<svg viewBox='0 0 24 24' fill='none' stroke='%23000000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' xmlns='http://www.w3.org/2000/svg'><path d='M15 3h6v6'/><path d='M10 14 21 3'/><path d='M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6'/></svg>");
						mask-repeat: no-repeat;
						mask-size: contain;
					}</style><style>.fi{fill:none;stroke-linecap:round;stroke-linejoin:round;vertical-align:middle}</style></head><body class="page-template"><div class="container container--center"><header class="header"><div class="header__logo"><a class="logo" href="https://www.shoib.me/"><img src="https://www.shoib.me/media/website/icons8-swot-analysis-400.png" alt="Shoib&#x27;s Space" width="400" height="400"></a></div><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://www.shoib.me/projects-and-case-studies/" target="_self">Projects &amp; Case Studies</a></li><li><a href="https://www.shoib.me/services-and-solutions/" target="_self">Services &amp; Solutions</a></li><li><a href="https://www.shoib.me/blog-and-insights/" target="_self">Blog</a></li><li><a href="https://www.shoib.me/enter-password-to-view-content/" target="_self">Enter Password to View Content</a></li></ul></nav></header><main class="content page"><article class="post"><header><h1 class="post__title">Advanced Qibla Direction Finder</h1></header><div class="post__entry"><div class="outer-box"><div class="container"><h1>Advanced Qibla Direction Finder</h1><div style="text-align: center;"><button id="fetch-location">Find Qibla Direction</button></div><div id="result"><p id="qiblaText">Click 'Find Qibla Direction' to start.</p><div class="compass"><div class="needle"> </div><div class="direction north">N</div><div class="direction east">E</div><div class="direction south">S</div><div class="direction west">W</div></div><p id="guide">Ensure your device’s compass is calibrated for accurate results.</p></div><footer><p>Qibla direction calculated locally using your device's sensors.</p><p>Accuracy depends on device capabilities and calibration.</p></footer></div></div><p><script>const KAABA_LATITUDE = 21.4225;
    const KAABA_LONGITUDE = 39.8262;
    
    let qiblaAngle = null;
    let orientationSensorActive = false;

    const fetchButton = document.getElementById('fetch-location');
    const qiblaTextElement = document.getElementById('qiblaText');
    const needleElement = document.querySelector('.needle');
    const guideElement = document.getElementById('guide');

    function showLoading(message) {
      qiblaTextElement.textContent = message;
      fetchButton.disabled = true;
    }

    function displayError(message) {
      qiblaTextElement.innerHTML = `<span style="color:red;">Error: ${message}</span>`;
      fetchButton.disabled = false;
    }

    function calculateQiblaDirection(userLat, userLong) {
      const lat1Rad = userLat * Math.PI / 180;
      const lat2Rad = KAABA_LATITUDE * Math.PI / 180;
      const deltaLongRad = (KAABA_LONGITUDE - userLong) * Math.PI / 180;
      
      const y = Math.sin(deltaLongRad);
      const x = Math.cos(lat1Rad) * Math.tan(lat2Rad) - Math.sin(lat1Rad) * Math.cos(deltaLongRad);
      let qiblaRad = Math.atan2(y, x);
      let qiblaDeg = qiblaRad * 180 / Math.PI;
      
      if (qiblaDeg < 0) {
        qiblaDeg += 360;
      }
      return qiblaDeg;
    }

    function updateQiblaDisplay(angle, heading = null) {
        qiblaAngle = angle; // Store the calculated Qibla angle

        if (heading !== null && orientationSensorActive) {
            // Dynamic mode: Qibla relative to device heading
            let relativeAngle = angle - heading;
            needleElement.style.transform = `translateX(-50%) rotate(${relativeAngle}deg)`;
            qiblaTextElement.innerHTML = `Qibla: <strong>${angle.toFixed(1)}°</strong> <small>(from N)</small> | Device Heading: <strong>${Math.round(heading)}°</strong>`;
            guideElement.innerHTML = "Compass is active. Red needle points to Qibla relative to your device.<br>Ensure compass is calibrated.";
        } else {
            // Static mode: Qibla relative to North (top of compass)
            needleElement.style.transform = `translateX(-50%) rotate(${angle}deg)`;
            qiblaTextElement.innerHTML = `Qibla Direction: <strong>${angle.toFixed(1)}°</strong> <small>(from True North)</small>`;
            if (orientationSensorActive) { // Sensor was expected but no heading data
                 guideElement.innerHTML = "Trying to use device orientation. If needle isn't moving, point device top to True North.<br>Ensure compass is calibrated.";
            } else {
                 guideElement.innerHTML = "Device orientation sensor not active or permission denied. Point device top to True North. Needle shows Qibla.<br>Ensure compass is calibrated.";
            }
        }
    }


    function handleDeviceOrientation(event) {
        if (document.hidden) return; // Don't process if page is not visible

        const heading = event.webkitCompassHeading !== undefined ? event.webkitCompassHeading : event.alpha;

        if (heading !== null) {
            orientationSensorActive = true; // Sensor is providing data
            if (qiblaAngle !== null) {
                updateQiblaDisplay(qiblaAngle, heading);
            }
        } else if (orientationSensorActive) {
            // Was active, but now heading is null (e.g., sensor error)
            orientationSensorActive = false;
            if (qiblaAngle !== null) {
                updateQiblaDisplay(qiblaAngle); // Revert to static display
            }
        }
    }
    
    async function requestPermissionsAndFetchQibla() {
        showLoading('Processing...');
        orientationSensorActive = false; // Reset

        // Attempt to get device orientation permission (for iOS 13+)
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            try {
                qiblaTextElement.textContent = 'Requesting orientation permission...';
                const permissionState = await DeviceOrientationEvent.requestPermission();
                if (permissionState === 'granted') {
                    window.addEventListener('deviceorientation', handleDeviceOrientation);
                    // orientationSensorActive will be set by handleDeviceOrientation if it gets data
                } else {
                    guideElement.innerHTML = "Orientation permission denied. Compass will be static.<br>Point device top to True North.";
                }
            } catch (error) {
                console.warn('Error requesting orientation permission:', error);
                guideElement.innerHTML = "Could not get orientation permission. Compass will be static.<br>Point device top to True North.";
            }
        } else if (window.DeviceOrientationEvent) {
            // For browsers that don't require explicit permission (e.g., Android with HTTPS)
            window.addEventListener('deviceorientation', handleDeviceOrientation);
        }

        // Fetch Geolocation
        if (!navigator.geolocation) {
            displayError('Geolocation is not supported by this browser.');
            return;
        }
        
        qiblaTextElement.textContent = 'Fetching location...';
        navigator.geolocation.getCurrentPosition(
            (position) => { // Success callback
                const userLatitude = position.coords.latitude;
                const userLongitude = position.coords.longitude;
                const calculatedAngle = calculateQiblaDirection(userLatitude, userLongitude);
                updateQiblaDisplay(calculatedAngle); // Initial display (static or dynamic if orientation already active)
                fetchButton.disabled = false;
            },
            (error) => { // Error callback
                displayError(`Getting location: ${error.message}`);
                // Keep button disabled if permission was the main action, or enable if appropriate.
                // For now, re-enable as location is primary for calculation.
                fetchButton.disabled = false;
            },
            { timeout: 10000, enableHighAccuracy: true }
        );
    }

    fetchButton.addEventListener('click', requestPermissionsAndFetchQibla);

    // Initial state texts
    qiblaTextElement.textContent = "Click 'Find Qibla Direction' to start.";
    guideElement.innerHTML = "Ensure your device’s compass is calibrated for accurate results.";</script></p></div></article></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p><span style="color: #2dc26b;">© 2025 All rights reserved. This website and its content are the property of the owner</span></p></div></div></footer></div><script defer="defer" src="https://www.shoib.me/assets/js/scripts.min.js?v=c2232aa7558e9517946129d2a1b8c770"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'overlay',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script>(function() {
			var originalTitle = document.title;
			var timeout;
			document.addEventListener("visibilitychange", function() {
				if (document.hidden) {
					document.title = "👀 We miss you! Plz Come back!";
				} else {
					clearTimeout(timeout);
					document.title = "🎉 Welcome back!";
							setTimeout(function() {
								document.title = originalTitle;
							}, 2000);
				}
			});
		})();</script></body></html>